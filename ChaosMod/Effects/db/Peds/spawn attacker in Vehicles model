#include <stdafx.h>

static void OnStart()
{
    // Placeholder untuk model ped. Ganti dengan model yang diinginkan.
    static const std::vector<int> pedModels = {
        0x9C9EFFD8, 0xB87CFFD0, 0xE5C4B8E7, 0xDA3A6756
    };

    // Placeholder untuk model kendaraan. Ganti dengan model yang diinginkan.
    static const Hash carModel = "apc"_hash;

    // Placeholder untuk senjata. Ganti dengan senjata yang diinginkan.
    static const Hash weaponHash = "weapon_combatpistol"_hash;

    Hash relationshipGroup;
    ADD_RELATIONSHIP_GROUP("_ENEMY_GROUP", &relationshipGroup);
    SET_RELATIONSHIP_BETWEEN_GROUPS(5, relationshipGroup, "PLAYER"_hash);
    SET_RELATIONSHIP_BETWEEN_GROUPS(5, "PLAYER"_hash, relationshipGroup);

    Ped playerPed     = PLAYER_PED_ID();
    Vector3 playerPos = GET_ENTITY_COORDS(playerPed, false);
    float heading = GET_ENTITY_HEADING(IS_PED_IN_ANY_VEHICLE(playerPed, false) ? GET_VEHICLE_PED_IS_IN(playerPed, false)
                                                                               : playerPed);

    Vehicle veh = CreatePoolVehicle(carModel, playerPos.x, playerPos.y, playerPos.z, heading);
    SET_VEHICLE_COLOURS(veh, 148, 148);
    SET_VEHICLE_ENGINE_ON(veh, true, true, false);

    WAIT(0);

    for (int i = 0; i < 2; i++)
    {
        Hash chosenPedModel = pedModels.at(g_Random.GetRandomInt(0, pedModels.size() - 1));
        Ped ped = CreatePoolPed(4, chosenPedModel, playerPos.x, playerPos.y, playerPos.z, GET_ENTITY_HEADING(playerPed));
        if (i == 0)
        {
            SET_PED_INTO_VEHICLE(ped, veh, -1);
        }
        else
        {
            SET_PED_INTO_VEHICLE(ped, veh, -2);
        }
        SET_PED_COMBAT_ATTRIBUTES(ped, 3, false);
        SET_BLOCKING_OF_NON_TEMPORARY_EVENTS(ped, true);
        SET_PED_RELATIONSHIP_GROUP_HASH(ped, relationshipGroup);
        SET_PED_HEARING_RANGE(ped, 9999.f);
        GIVE_WEAPON_TO_PED(ped, weaponHash, 9999, true, true);
        SET_PED_ACCURACY(ped, 50);
        TASK_COMBAT_PED(ped, playerPed, 0, 16);
    }
}

REGISTER_EFFECT(OnStart, nullptr, nullptr, EffectInfo
    {
        .Name = "Spawn Custom Squad",
        .Id = "peds_spawncustomsquad",
        .EffectGroupType = EffectGroupType::SpawnEnemy
    }
);
